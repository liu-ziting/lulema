import{m as t,d as e,p as s,g as a,q as n,a as o,u as c,v as r,c as l,w as i,i as d,o as u,b as p,e as h,f as _,t as m,h as y,j as f,F as g,x as S,y as T,k,S as D,n as w}from"./index-BrY2dOaY.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";function U(t,e,s,a){return new(s||(s=Promise))((function(n,o){function c(t){try{l(a.next(t))}catch(e){o(e)}}function r(t){try{l(a.throw(t))}catch(e){o(e)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(c,r)}l((a=a.apply(t,e||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class C extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{content:{type:String,optional:!1},success:{type:Boolean,optional:!1}}}}}constructor(t,e=C.get$UTSMetadata$(),s=!1){super(),this.__props__=UTS.UTSType.initProps(t,e,s),this.content=this.__props__.content,this.success=this.__props__.success,delete this.__props__}}class b extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{timestamp:{type:Number,optional:!1},reason:{type:String,optional:!1}}}}}constructor(t,e=b.get$UTSMetadata$(),s=!1){super(),this.__props__=UTS.UTSType.initProps(t,e,s),this.timestamp=this.__props__.timestamp,this.reason=this.__props__.reason,delete this.__props__}}class A extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{timestamp:{type:Number,optional:!1},reason:{type:String,optional:!1}}}}}constructor(t,e=A.get$UTSMetadata$(),s=!1){super(),this.__props__=UTS.UTSType.initProps(t,e,s),this.timestamp=this.__props__.timestamp,this.reason=this.__props__.reason,delete this.__props__}}class x extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{day:{type:Number,optional:!1},month:{type:Number,optional:!1},year:{type:Number,optional:!1},isCurrentMonth:{type:Boolean,optional:!1},count:{type:Number,optional:!1},timestamp:{type:Number,optional:!1},isToday:{type:Boolean,optional:!1}}}}}constructor(t,e=x.get$UTSMetadata$(),s=!1){super(),this.__props__=UTS.UTSType.initProps(t,e,s),this.day=this.__props__.day,this.month=this.__props__.month,this.year=this.__props__.year,this.isCurrentMonth=this.__props__.isCurrentMonth,this.count=this.__props__.count,this.timestamp=this.__props__.timestamp,this.isToday=this.__props__.isToday,delete this.__props__}}class v extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{reason:{type:String,optional:!1},count:{type:Number,optional:!1},percentage:{type:Number,optional:!1}}}}}constructor(t,e=v.get$UTSMetadata$(),s=!1){super(),this.__props__=UTS.UTSType.initProps(t,e,s),this.reason=this.__props__.reason,this.count=this.__props__.count,this.percentage=this.__props__.percentage,delete this.__props__}}const $=M(e({data:()=>({totalCount:0,todayCount:0,maxStreak:0,currentStreak:0,currentYear:0,currentMonth:0,weekDays:["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"],calendarDays:[],checkins:[],selectedDate:null,showDayModal:!1,isAnalyzing:!1,showAiModal:!1,aiAnalysisContent:"",reportDateStr:"",reasonStats:[]}),computed:{closeBtnTop:()=>s().statusBarHeight+15,selectedDateStr(){return null==this.selectedDate?"":"".concat(this.selectedDate.year,"å¹´").concat(this.selectedDate.month,"æœˆ").concat(this.selectedDate.day,"æ—¥")},selectedDayRecords(){if(null==this.selectedDate)return[];const t=new Date(this.selectedDate.year,this.selectedDate.month-1,this.selectedDate.day).getTime(),e=t+864e5;return this.checkins.filter((s=>s.timestamp>=t&&s.timestamp<e)).sort(((t,e)=>e.timestamp-t.timestamp))}},onShow(){const t=new Date;this.currentYear=t.getFullYear(),this.currentMonth=t.getMonth()+1,this.loadStats()},methods:{startAiAnalysis(){return U(this,void 0,void 0,(function*(){if(this.checkins.length<3)return o({title:"æ•°æ®å¤ªå°‘ï¼Œå†åšæŒæ‰“å¡å‡ æ¬¡å§",icon:"none"}),Promise.resolve(null);this.isAnalyzing=!0,c({title:"é¹¿å¸ˆå‚…æ€è€ƒä¸­..."});try{const s=yield(e=this.checkins,new Promise(((s,a)=>{let n="æˆ‘æœ€è¿‘çš„æ‰“å¡è®°å½•å¦‚ä¸‹ï¼š\n";e.slice(-20).forEach(((t=null,e)=>{let s=0,a="";if(UTS.isInstanceOf(t,UTSJSONObject))s=t.getNumber("timestamp"),a=t.getString("reason");else{const e=t;s=e.timestamp,a=e.reason}const o=new Date(s),c="".concat(o.getMonth()+1,"æœˆ").concat(o.getDate(),"æ—¥ ").concat(o.getHours(),":").concat(o.getMinutes()),r=""==a?"æœªè®°å½•åŽŸå› ":a;n+="".concat(e+1,". æ—¶é—´ï¼š").concat(c,"ï¼ŒåŽŸå› ï¼š").concat(r,"\n")})),n+="\nè¯·æ‰®æ¼”ä¸€ä½æ—¢å¹½é»˜åˆçŠ€åˆ©çš„â€œæˆ’è‰²æŸå‹â€å…¼â€œé‡‘ç‰Œæ•™ç»ƒâ€ã€‚è¯·æ ¹æ®æˆ‘çš„è®°å½•ï¼Œç”¨â€œä½ æ€»æ˜¯åœ¨...ç„¶åŽ...æœ€åŽ...â€çš„å™è¿°é£Žæ ¼æ¥åˆ†æžæˆ‘çš„è¡Œä¸ºæ¨¡å¼ã€‚\nå…·ä½“è¦æ±‚ï¼š\n1. ðŸ•µï¸ è§„å¾‹æ­ç§˜ï¼šç”¨â€œæˆ‘çœ‹å‡ºæ¥äº†ï¼Œä½ æ€»æ˜¯åœ¨...â€å¼€å¤´ï¼Œä¸€é’ˆè§è¡€ä¸”ç•¥å¸¦è°ƒä¾ƒåœ°æŒ‡å‡ºæˆ‘çš„é«˜é£Žé™©æ—¶é—´ç‚¹å’Œå€Ÿå£ï¼ˆæ¯”å¦‚â€œä½ æ€»æ˜¯åœ¨æ·±å¤œå¯‚å¯žéš¾è€çš„æ—¶å€™å·å·â€˜é¹¿â€™ï¼Œæ˜¯ä¸æ˜¯ä»¥ä¸ºè¢«çªé‡Œå°±æ˜¯æ³•å¤–ä¹‹åœ°ï¼Ÿâ€ï¼‰ã€‚\n2. ðŸ“‰ å‰§æƒ…æŽ¨æ¼”ï¼šæŽ¥ç€ç”¨â€œç„¶åŽ...â€æè¿°æˆ‘äº‹åŽçš„çŠ¶æ€ï¼ˆæ¯”å¦‚â€œç„¶åŽé™·å…¥è´¤è€…æ—¶é—´çš„æ— å°½ç©ºè™šï¼Œçœ‹ç€å¤©èŠ±æ¿å‘èª“è¿™æ˜¯æœ€åŽä¸€æ¬¡ï¼Œç»“æžœä¸‹æ¬¡è¿˜æ•¢â€ï¼‰ã€‚\n3. ðŸ’¡ æ¸©é¦¨æç¤ºï¼šæœ€åŽç»™å‡ºä¸€ä»½â€œæ¸©é¦¨æç¤ºâ€ï¼ŒåŒ…å«3ä¸ªæœ‰è¶£ä½†ç¡¬æ ¸çš„å»ºè®®ï¼Œè¯­æ°”è¦åƒè€æœ‹å‹ä¸€æ ·çœŸè¯šï¼ˆæ¯”å¦‚â€œæ¸©é¦¨æç¤ºï¼šä¸‹æ¬¡æ‰‹ç—’çš„æ—¶å€™ï¼Œä¸å¦‚åšä¸ªä¿¯å§æ’‘ï¼Œåˆ«è®©å«ç”Ÿçº¸æˆä¸ºä½ å”¯ä¸€çš„å¬ä¼—â€ï¼‰ã€‚\nè¯·ç›´æŽ¥å¼€å§‹ä½ çš„è¡¨æ¼”ï¼Œä¸è¦æœ‰ä»»ä½•å¼€åœºç™½ã€‚",t({url:"https://open.bigmodel.cn/api/paas/v4/chat/completions",method:"POST",header:new UTSJSONObject({"Content-Type":"application/json",Authorization:"Bearer a835b9f6866d48ec956d341418df8a50.NuhlKYn58EkCb5iP"}),data:{model:"glm-4-flash",messages:[new UTSJSONObject({role:"user",content:n})],temperature:.7},success:t=>{const e=t.data;if(null!=e.choices){const t=e.choices;if(t.length>0){const e=t[0].message.content;return s(new C({content:e,success:!0})),null}}s(new C({content:"åˆ†æžå¤±è´¥ï¼Œè¯·ç¨åŽå†è¯•",success:!1}))},fail:t=>{console.error("AI Request Failed:",t),s(new C({content:"ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ",success:!1}))}})})));if(s.success){this.aiAnalysisContent=s.content;const t=new Date;this.reportDateStr="".concat(t.getFullYear(),"/").concat(t.getMonth()+1,"/").concat(t.getDate()," ").concat(t.getHours().toString().padStart(2,"0"),":").concat(t.getMinutes().toString().padStart(2,"0")),this.showAiModal=!0}else o({title:s.content,icon:"none"})}catch(s){o({title:"åˆ†æžå‡ºé”™äº†",icon:"none"})}finally{this.isAnalyzing=!1,r()}var e}))},closeAiModal(){this.showAiModal=!1},formatTime(t){const e=new Date(t),s=e.getHours().toString().padStart(2,"0"),a=e.getMinutes().toString().padStart(2,"0");return"".concat(s,":").concat(a)},loadStats(){const t=a("lulema_checkins_v2");if(this.checkins=[],Array.isArray(t)){const e=t;this.checkins=e.map(((t=null)=>{const e=new UTSJSONObject(t);return new A({timestamp:e.getNumber("timestamp"),reason:e.getString("reason")})}))}else{const t=a("lulema_checkins");if(Array.isArray(t)){const e=t;this.checkins=e.map((t=>new A({timestamp:t,reason:""})))}}this.totalCount=this.checkins.length;const e=new Date,s=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime();this.todayCount=this.checkins.filter((t=>t.timestamp>=s)).length,this.calculateStreak(),this.calculateReasons(),this.generateCalendar()},calculateReasons(){const t=new Map;let e=0;this.checkins.forEach((s=>{const a=s.reason||"æœªè®°å½•",n=UTS.mapGet(t,a)||0;t.set(a,n+1),e++}));const s=[];t.forEach(((t,a)=>{s.push(new v({reason:a,count:t,percentage:e>0?Math.round(t/e*100):0}))})),this.reasonStats=s.sort(((t,e)=>e.count-t.count))},calculateStreak(){if(0===this.checkins.length)return this.maxStreak=0,null;const t=this.checkins.sort(((t,e)=>t.timestamp-e.timestamp)),e=new Set;t.forEach((t=>{const s=new Date(t.timestamp);e.add("".concat(s.getFullYear(),"-").concat(s.getMonth()+1,"-").concat(s.getDate()))}));const s=[];e.forEach((t=>{const e=t.split("-"),a=new Date(parseInt(e[0]),parseInt(e[1])-1,parseInt(e[2]),12,0,0);s.push(a.getTime())})),s.sort(((t,e)=>t-e));let a=0,n=0;if(s.length>0){a=1,n=1;for(let t=1;t<s.length;t++){const e=s[t]-s[t-1];e<1296e5&&e>432e5?a++:a=1,a>n&&(n=a)}}this.maxStreak=n,this.currentStreak=a},changeMonth(t){let e=this.currentYear,s=this.currentMonth+t;s>12?(e++,s=1):s<1&&(e--,s=12),this.currentYear=e,this.currentMonth=s,this.generateCalendar()},generateCalendar(){this.calendarDays=[];const t=this.currentYear,e=this.currentMonth-1,s=new Date(t,e,1),a=new Date(t,e+1,0).getDate(),n=s.getDay(),o=new Date(t,e,0).getDate();for(let u=n-1;u>=0;u--)this.calendarDays.push(new x({day:o-u,month:e,year:0===e?t-1:t,isCurrentMonth:!1,count:0,timestamp:0,isToday:!1}));const c=new Date,r=c.getFullYear(),l=c.getMonth(),i=c.getDate();for(let u=1;u<=a;u++){const s=new Date(t,e,u).getTime(),a=new Date(t,e,u+1).getTime(),n=this.checkins.filter((t=>t.timestamp>=s&&t.timestamp<a)).length,o=t===r&&e===l&&u===i;this.calendarDays.push(new x({day:u,month:e+1,year:t,isCurrentMonth:!0,count:n,timestamp:s,isToday:o}))}const d=42-this.calendarDays.length;for(let u=1;u<=d;u++)this.calendarDays.push(new x({day:u,month:e+2,year:11===e?t+1:t,isCurrentMonth:!1,count:0,timestamp:0,isToday:!1}))},selectDate(t){this.selectedDate=t,this.showDayModal=!0},closeDayModal(){this.showDayModal=!1},isSameDay:(t=null,e)=>!!t&&(t.day===e.day&&t.month===e.month&&t.year===e.year),goToSettings(){n({url:"/pages/settings/settings"})}}}),[["render",function(t,e,s,a,n,o){const c=k,r=d,M=D;return u(),l(r,{class:"content"},{default:i((()=>[p(r,{class:"privacy-card"},{default:i((()=>[p(r,{class:"privacy-icon-box"},{default:i((()=>[p(c,{class:"privacy-icon"},{default:i((()=>[h("ðŸ”’")])),_:1})])),_:1}),p(r,{class:"privacy-content"},{default:i((()=>[p(c,{class:"privacy-title"},{default:i((()=>[h("éšç§å®‰å…¨ä¿æŠ¤ä¸­")])),_:1}),p(c,{class:"privacy-desc"},{default:i((()=>[h("æ•°æ®ä»…å­˜å‚¨åœ¨æœ¬åœ°ï¼Œæ‚¨çš„ç§˜å¯†åªæœ‰è‡ªå·±çŸ¥é“ã€‚")])),_:1})])),_:1}),_("",!0)])),_:1}),p(r,{class:"stats-card"},{default:i((()=>[p(r,{class:"stats-row"},{default:i((()=>[p(r,{class:"stat-item"},{default:i((()=>[p(c,{class:"stat-num"},{default:i((()=>[h(m(n.totalCount),1)])),_:1}),p(c,{class:"stat-label"},{default:i((()=>[h("æ€»ç ´æˆ’")])),_:1})])),_:1}),p(r,{class:"stat-item"},{default:i((()=>[p(c,{class:"stat-num"},{default:i((()=>[h(m(n.currentStreak),1)])),_:1}),p(c,{class:"stat-label"},{default:i((()=>[h("å½“å‰è¿žå‡»")])),_:1})])),_:1}),p(r,{class:"stat-item"},{default:i((()=>[p(c,{class:"stat-num"},{default:i((()=>[h(m(n.maxStreak),1)])),_:1}),p(c,{class:"stat-label"},{default:i((()=>[h("æœ€é•¿è¿žå‡»")])),_:1})])),_:1})])),_:1}),p(r,{class:"ai-entry-btn",onClick:o.startAiAnalysis},{default:i((()=>[p(c,{class:"ai-icon"},{default:i((()=>[h("ðŸ©º")])),_:1}),p(c,{class:"ai-text"},{default:i((()=>[h("èŽ·å– AI æ·±åº¦è¯Šæ–­")])),_:1})])),_:1},8,["onClick"])])),_:1}),n.reasonStats.length>0?(u(),l(r,{key:0,class:"analysis-card"},{default:i((()=>[p(c,{class:"card-title"},{default:i((()=>[h("ç ´æˆ’åŽŸå› åˆ†æž")])),_:1}),p(r,{class:"chart-container"},{default:i((()=>[(u(!0),y(g,null,f(n.reasonStats,((t,e)=>(u(),l(r,{class:"chart-row",key:e},{default:i((()=>[p(c,{class:"chart-label"},{default:i((()=>[h(m(""==t.reason?"æœªçŸ¥":t.reason),1)])),_:2},1024),p(r,{class:"progress-container"},{default:i((()=>[p(r,{class:"progress-bar",style:T({width:t.percentage+"%"})},null,8,["style"])])),_:2},1024),p(c,{class:"chart-value"},{default:i((()=>[h(m(t.count)+"æ¬¡",1)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})):_("",!0),p(r,{class:"calendar-card"},{default:i((()=>[p(r,{class:"calendar-header"},{default:i((()=>[p(r,{class:"month-switch",onClick:e[0]||(e[0]=t=>o.changeMonth(-1))},{default:i((()=>[p(c,{class:"arrow-text"},{default:i((()=>[h("â—€")])),_:1})])),_:1}),p(c,{class:"current-date"},{default:i((()=>[h(m(n.currentYear)+"å¹´"+m(n.currentMonth)+"æœˆ",1)])),_:1}),p(r,{class:"month-switch",onClick:e[1]||(e[1]=t=>o.changeMonth(1))},{default:i((()=>[p(c,{class:"arrow-text"},{default:i((()=>[h("â–¶")])),_:1})])),_:1})])),_:1}),p(r,{class:"week-row"},{default:i((()=>[(u(!0),y(g,null,f(n.weekDays,(t=>(u(),l(c,{class:"week-item",key:t},{default:i((()=>[h(m(t),1)])),_:2},1024)))),128))])),_:1}),p(r,{class:"days-grid"},{default:i((()=>[(u(!0),y(g,null,f(n.calendarDays,((t,e)=>(u(),l(r,{class:w(["day-item",{"not-current":!t.isCurrentMonth,"has-checkin":t.count>0,today:t.isToday,selected:o.isSameDay(n.selectedDate,t)}]),key:e,onClick:e=>o.selectDate(t)},{default:i((()=>[p(c,{class:"day-num"},{default:i((()=>[h(m(t.day),1)])),_:2},1024),t.count>0?(u(),l(r,{key:0,class:"checkin-dot"})):_("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),p(r,{class:"calendar-footer"},{default:i((()=>[p(c,{class:"footer-tip"},{default:i((()=>[h("ç‚¹å‡»æ—¥æœŸæŸ¥çœ‹è¯¦æƒ…")])),_:1})])),_:1})])),_:1}),n.showDayModal?(u(),l(r,{key:1,class:"modal-overlay",onClick:o.closeDayModal},{default:i((()=>[p(r,{class:"modal-content",onClick:e[2]||(e[2]=S((()=>{}),["stop"]))},{default:i((()=>[p(c,{class:"modal-close",onClick:o.closeDayModal},{default:i((()=>[h("Ã—")])),_:1},8,["onClick"]),p(r,{class:"modal-header"},{default:i((()=>[p(c,{class:"modal-title"},{default:i((()=>[h(m(o.selectedDateStr),1)])),_:1})])),_:1}),p(M,{class:"records-list","scroll-y":"true"},{default:i((()=>[0===o.selectedDayRecords.length?(u(),l(r,{key:0,class:"empty-state"},{default:i((()=>[p(c,{class:"empty-text"},{default:i((()=>[h("å½“æ—¥æ— ç ´æˆ’è®°å½•ï¼Œç»§ç»­ä¿æŒï¼")])),_:1})])),_:1})):(u(!0),y(g,{key:1},f(o.selectedDayRecords,((t,e)=>(u(),l(r,{class:"record-item",key:e},{default:i((()=>[p(r,{class:"record-time-box"},{default:i((()=>[p(c,{class:"record-time"},{default:i((()=>[h(m(o.formatTime(t.timestamp)),1)])),_:2},1024)])),_:2},1024),p(r,{class:"record-info"},{default:i((()=>[p(c,{class:"record-reason"},{default:i((()=>[h(m(""==t.reason?"æœªè®°å½•åŽŸå› ":t.reason),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1},8,["onClick"])):_("",!0),n.showAiModal?(u(),l(r,{key:2,class:"modal-overlay",onClick:o.closeAiModal},{default:i((()=>[p(r,{class:"modal-content ai-report-card",onClick:e[3]||(e[3]=S((()=>{}),["stop"]))},{default:i((()=>[p(r,{class:"report-stripe"}),p(c,{class:"modal-close report-close",style:T({top:o.closeBtnTop+"px"}),onClick:o.closeAiModal},{default:i((()=>[h("Ã—")])),_:1},8,["style","onClick"]),p(r,{class:"report-header"},{default:i((()=>[p(c,{class:"report-title"},{default:i((()=>[h("ðŸ“‹ è¡Œä¸ºè¯Šæ–­æŠ¥å‘Š")])),_:1}),p(c,{class:"report-date"},{default:i((()=>[h("è¯Šæ–­æ—¶é—´ï¼š"+m(n.reportDateStr),1)])),_:1})])),_:1}),p(r,{class:"report-divider"}),p(M,{class:"report-body","scroll-y":"true"},{default:i((()=>[p(c,{class:"report-text"},{default:i((()=>[h(m(n.aiAnalysisContent),1)])),_:1})])),_:1}),p(r,{class:"report-footer"},{default:i((()=>[p(r,{class:"report-stamp"},{default:i((()=>[p(c,{class:"stamp-text"},{default:i((()=>[h("LULEMA")])),_:1}),p(c,{class:"stamp-sub"},{default:i((()=>[h("AI LAB")])),_:1})])),_:1}),p(c,{class:"report-signature"},{default:i((()=>[h("ä¸»æ²»åŒ»å¸ˆï¼šLulema AI æ•™ç»ƒ")])),_:1})])),_:1})])),_:1})])),_:1},8,["onClick"])):_("",!0)])),_:1})}],["__scopeId","data-v-d41b1ce2"]]);export{$ as default};
