import{d as t,g as s,r as e,s as a,a as o,c as l,w as n,i as c,o as i,b as r,e as d,n as u,t as h,f as m,h as _,j as p,F as f,k as g,l as w}from"./index-BrY2dOaY.js";import{_ as k}from"./_plugin-vue_export-helper.BCo6x5W8.js";class y extends UTS.UTSType{static get$UTSMetadata$(){return{kind:2,get fields(){return{timestamp:{type:Number,optional:!1},reason:{type:String,optional:!1}}}}}constructor(t,s=y.get$UTSMetadata$(),e=!1){super(),this.__props__=UTS.UTSType.initProps(t,s,e),this.timestamp=this.__props__.timestamp,this.reason=this.__props__.reason,delete this.__props__}}const C=k(t({data:()=>({todayCount:0,streakDays:0,tips:"准备好开始了吗？",isAnimating:!1,showModal:!1,showReasonModal:!1,coolDownSeconds:0,coolDownTimer:0,quotes:["小撸怡情，大撸伤身，强撸灰飞烟灭","注意身体，少年！","多喝热水，保持水分","在这个喧嚣的世界，独享此刻的宁静","又是一次灵魂的升华","适当释放，有益身心","只有累死的牛，没有耕坏的田","这就是青春啊！","贤者时间，思考人生","手速惊人！","每一次颤抖，都是生命的律动","放下手机，立地成佛"],reasons:["无聊","压力大","失眠","心情差","看片了","习惯","晨勃","忍不住"]}),computed:{statusText(){return 0===this.todayCount?"精力充沛":1===this.todayCount?"贤者模式":2===this.todayCount?"略显疲态":"身体透支"},statusClass(){return 0===this.todayCount?"status-green":1===this.todayCount?"status-blue":2===this.todayCount?"status-yellow":"status-red"},statusTextClass(){return this.todayCount>=3?"text-red":""},coolDownText(){const t=["冲动是魔鬼，要不再忍忍？","想想你的发际线，真的要继续吗？","色即是空，空即是色，施主请三思。","再坚持一下，你就是意志力的神！","现在收手，还来得及！"];return t[Math.floor(Math.random()*t.length)]}},onShow(){this.loadData()},methods:{loadData(){const t=s("lulema_checkins_v2");let o=[];const l=s("lulema_checkins");if(Array.isArray(l)&&l.length>0){l.forEach((t=>{o.push(new y({timestamp:t,reason:""}))})),e("lulema_checkins"),a("lulema_checkins_v2",o)}else if(Array.isArray(t)){o=t.map(((t=null)=>{const s=new UTSJSONObject(t);return new y({timestamp:s.getNumber("timestamp"),reason:s.getString("reason")})}))}const n=new Date,c=new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime();this.todayCount=o.filter((t=>t.timestamp>=c)).length,this.calculateStreak(o),this.updateTips()},calculateStreak(t){if(0===t.length)return this.streakDays=0,null;const s=t.sort(((t,s)=>t.timestamp-s.timestamp)),e=new Set;s.forEach((t=>{const s=new Date(t.timestamp);e.add("".concat(s.getFullYear(),"-").concat(s.getMonth()+1,"-").concat(s.getDate()))}));const a=[];e.forEach((t=>{const s=t.split("-"),e=new Date(parseInt(s[0]),parseInt(s[1])-1,parseInt(s[2]),12,0,0);a.push(e.getTime())})),a.sort(((t,s)=>t-s));let o=0;if(a.length>0){const t=new Date,s="".concat(t.getFullYear(),"-").concat(t.getMonth()+1,"-").concat(t.getDate()),e=new Date(t.getTime()-864e5),l="".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate()),n=new Date(a[a.length-1]),c="".concat(n.getFullYear(),"-").concat(n.getMonth()+1,"-").concat(n.getDate());if(c!==s&&c!==l)return this.streakDays=0,null;o=1;for(let i=a.length-1;i>0;i--){const t=a[i]-a[i-1];if(!(t<1296e5&&t>432e5))break;o++}}this.streakDays=o},openCheckInModal(){this.showModal=!0,this.coolDownSeconds=3,this.coolDownTimer=setInterval((()=>{this.coolDownSeconds>0?this.coolDownSeconds--:clearInterval(this.coolDownTimer)}),1e3)},cancelCheckIn(){clearInterval(this.coolDownTimer),this.showModal=!1,o({title:"意志力+1，佩服！",icon:"none"})},confirmCheckIn(){clearInterval(this.coolDownTimer),this.showModal=!1,this.showReasonModal=!0},selectReason(t){this.showReasonModal=!1,this.handleCheckIn(t)},skipReason(){this.showReasonModal=!1,this.handleCheckIn("")},handleCheckIn(t){this.isAnimating=!0,setTimeout((()=>{this.isAnimating=!1}),600);const e=s("lulema_checkins_v2");let l=[];if(Array.isArray(e)){l=e.map(((t=null)=>{const s=new UTSJSONObject(t);return new y({timestamp:s.getNumber("timestamp"),reason:s.getString("reason")})}))}l.push(new y({timestamp:Date.now(),reason:t})),a("lulema_checkins_v2",l),this.todayCount++,this.loadData(),o({title:"打卡成功",icon:"success",duration:2e3})},updateTips(){if(0===this.todayCount)this.tips="今天还没有记录哦，保持清心寡欲？";else if(this.todayCount>5)this.tips="求求你别鹿了，身体要紧！";else{const t=Math.floor(Math.random()*this.quotes.length);this.tips=this.quotes[t]}}}}),[["render",function(t,s,e,a,o,k){const y=g,C=c,D=w;return i(),l(C,{class:"container"},{default:n((()=>[r(C,{class:"header"},{default:n((()=>[r(y,{class:"title"},{default:n((()=>[d("鹿了吗")])),_:1}),r(y,{class:"subtitle"},{default:n((()=>[d("记录每一刻的释放")])),_:1})])),_:1}),r(C,{class:"main-content"},{default:n((()=>[r(C,{class:u(["status-badge",k.statusClass])},{default:n((()=>[r(y,{class:"status-badge-text"},{default:n((()=>[d(h(k.statusText),1)])),_:1})])),_:1},8,["class"]),r(C,{class:"circle-container",onClick:k.openCheckInModal,"hover-class":"circle-hover"},{default:n((()=>[r(C,{class:"circle-inner"},{default:n((()=>[r(y,{class:u(["circle-text",k.statusTextClass])},{default:n((()=>[d("鹿")])),_:1},8,["class"]),r(y,{class:"circle-subtext"},{default:n((()=>[d("点击打卡")])),_:1})])),_:1}),o.isAnimating?(i(),l(C,{key:0,class:"ripple-effect"})):m("",!0)])),_:1},8,["onClick"]),r(C,{class:"stats-row"},{default:n((()=>[r(C,{class:"status-card"},{default:n((()=>[r(y,{class:"status-label"},{default:n((()=>[d("今日次数")])),_:1}),r(y,{class:"status-value"},{default:n((()=>[d(h(o.todayCount),1)])),_:1})])),_:1}),r(C,{class:"status-card"},{default:n((()=>[r(y,{class:"status-label"},{default:n((()=>[d("连续天数")])),_:1}),r(y,{class:"status-value"},{default:n((()=>[d(h(o.streakDays),1)])),_:1})])),_:1})])),_:1}),r(C,{class:"tips-container"},{default:n((()=>[r(y,{class:"tips-text"},{default:n((()=>[d(h(o.tips),1)])),_:1})])),_:1})])),_:1}),o.showModal?(i(),l(C,{key:0,class:"modal-overlay"},{default:n((()=>[r(C,{class:"modal-content"},{default:n((()=>[r(y,{class:"modal-title"},{default:n((()=>[d("施主且慢")])),_:1}),r(y,{class:"modal-desc"},{default:n((()=>[d(h(k.coolDownText),1)])),_:1}),r(C,{class:"modal-actions"},{default:n((()=>[r(D,{class:"modal-btn btn-cancel",onClick:k.cancelCheckIn},{default:n((()=>[d("悬崖勒马")])),_:1},8,["onClick"]),r(D,{class:"modal-btn btn-confirm",disabled:o.coolDownSeconds>0,onClick:k.confirmCheckIn},{default:n((()=>[d(h(o.coolDownSeconds>0?"".concat(o.coolDownSeconds,"s 后可打卡"):"我意已决"),1)])),_:1},8,["disabled","onClick"])])),_:1})])),_:1})])),_:1})):m("",!0),o.showReasonModal?(i(),l(C,{key:1,class:"modal-overlay"},{default:n((()=>[r(C,{class:"modal-content"},{default:n((()=>[r(y,{class:"modal-title"},{default:n((()=>[d("为何破戒？")])),_:1}),r(C,{class:"reason-grid"},{default:n((()=>[(i(!0),_(f,null,p(o.reasons,((t,s)=>(i(),l(C,{class:"reason-item",key:s,onClick:s=>k.selectReason(t)},{default:n((()=>[r(y,{class:"reason-text"},{default:n((()=>[d(h(t),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1}),r(C,{class:"modal-actions",style:{"margin-top":"20px"}},{default:n((()=>[r(D,{class:"modal-btn btn-cancel",onClick:k.skipReason},{default:n((()=>[d("跳过")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1})):m("",!0)])),_:1})}],["__scopeId","data-v-9bec40df"]]);export{C as default};
